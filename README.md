# TextStation Pro
## プロジェクト概要
TextStation Proは、メディア・報道機関向けのテキスト処理プラットフォームです。Google Sheetsをフロントエンドとして活用し、Node.jsバックエンドで処理能力を拡張した実用的かつ軽量なシステムです。文章分析、過去原稿検索、定型文管理、PDF出力など、メディア業界の文章作成・編集ワークフローを効率化する機能を提供します。

**⚠️ 開発状況について**: 現在このプロジェクトは「概念実証」段階です。基本設計と実装コードは完成していますが、実環境での統合テストはまだ行われていません。このプロジェクトは主に個人的な学習と技術探求を目的として開発しています。クライアントからは「できたら使ってみたい」という緩やかな要望をいただいており、納期に関しては特に厳しい制約はありません。現時点では品質向上と機能拡張を進めながら、実用性を高めていく予定です。実際の本番環境への導入については、十分なテストと検証が完了した後に検討する予定です。(GASとNode.JSは連携して、レンダーに出してます)

## スプレッドシートの草案

https://docs.google.com/spreadsheets/d/1OWkq2xjPurG2EXoKBBEf_ed67cj7O1N-TuEED5uZMA4/edit?gid=1470928296#gid=1470928296

## 使用技術
### フロントエンド
* **Google Sheets / Google Apps Script (GAS)**:
   * 直感的なUI提供（エンドユーザーはスプレッドシートの操作感覚で利用可能）
   * クラウドベースで複数ユーザーでの共同編集に対応
   * シートに直接テキスト分析結果を表示

### バックエンド
* **Node.js**: GASの処理限界を超える高負荷処理の実行
* **Express.js**: RESTful API設計によるスケーラブルなバックエンド
* **Firebase/Firestore**:
   * NoSQLデータベースでスニペット管理
   * リアルタイム更新機能
   * 無料枠内での効率的運用設計
* **Google Drive API**: 過去ドキュメント検索と活用
* **PDFKit**: 高品質PDF生成

### インフラ
* **Render.com**: Node.jsバックエンドの無料ホスティング
* **Firebase**: バックエンド認証・データストレージ

## 機能と処理フロー

```
【ユーザー】 → 【Google Sheets UI】 → 【GAS (Code.gs)】 → 【Node.js API】 → 【Firebase/Drive】
    ↑                                   ↓               ↓              ↓
    └───────────────────────────────────┴───────────────┴──────────────┘
                            結果のフィードバック
```

## 主要機能と処理フロー
### 1. テキスト分析機能
* スプレッドシートでテキスト入力
* 基本統計（文字数等）を即時計算表示
* Node.jsバックエンドで高度分析（曖昧語・語尾かぶり検出）
* メディア種別（放送/新聞/雑誌/広告）に応じた最適化
* 分析結果を視覚的にハイライト表示

### 2. クラウドGREP機能
* Google Drive内の過去原稿をキーワード検索
* 検索結果の一致コンテキストを表示
* 複数ファイルタイプ（Docs/PDF/テキスト）対応
* 期間指定検索オプション

### 3. 定型文（スニペット）管理
* カテゴリ別スニペット整理
* 個人用/共有スニペット区分
* 変数置換機能（テンプレート文の動的カスタマイズ）
* ワンクリックでテキスト挿入

### 4. PDF出力機能
* カスタマイズ可能なPDF生成
* Google Driveへの自動保存
* ダウンロードリンク生成
* ヘッダー/フッター設定オプション

## 特徴・工夫点
### 1. ハイブリッドアーキテクチャ設計
* **GAS限界突破**: GASの6分実行制限を回避するため、重い処理はNode.jsにオフロード
* **フロントエンドの軽量化**: UIはすべてGoogle Sheetsで実現し、専用アプリ不要
* **非同期処理パイプライン**: 即時フィードバック（基本分析）と詳細分析を分離

### 2. 無料枠最適化アーキテクチャ
* **Firestore利用の最適化**: 共有リソースは単一ドキュメント、ログは週次バッチ集約
* **Render.comスリープモード対応**: 起動高速化とキャッシュ戦略
* **ファイル構成の最適化**: 全7ファイル、合計約1,600行の省メモリ設計
* **対費用効果の最大化**: 無料プランで運用可能な設計思想

### 3. メディア業界特化設計
* **4種のメディア対応**: 放送、新聞、雑誌、広告それぞれに特化したルール適用
* **業界固有課題対応**:
   * 曖昧表現の検出（「と思います」「たくさん」など）
   * 語尾のかぶり検出（「です/ます」の連続使用など）
   * メディアごとの文体チェック

### 4. 実務ワークフロー統合
* **スニペットシステム**: 頻出フレーズを共有・再利用
* **Drive検索連携**: 過去の記事・原稿を即座に検索して再活用
* **自動バックアップ**: 定期スナップショットによるデータ保護

## ファイル構成
システムは合計7ファイルで構成され、以下の3つのコンポーネントに分かれています：

### 1. GAS/スプレッドシートフロントエンド (2ファイル)
* **Code.gs** (約350行): UIとメイン処理
* **Triggers.gs** (約150行): 自動実行とバッチ処理

### 2. Node.jsバックエンド (4ファイル)
* **server.js** (約250行): APIサーバーメイン
* **text-processor.js** (約300行): テキスト分析エンジン
* **export.js** (約200行): PDF/CSV出力機能
* **utils.js** (約250行): 共通ユーティリティ

### 3. Firebase設定 (1ファイル)
* **firebase.json** (約100行): Firestore/Functions設定

## セットアップ手順
**注意**: 現在は開発中のため、実稼働環境でのセットアップは推奨されません。以下は開発・検証用のセットアップ手順です。

### 前提条件
* Google アカウント
* Node.js v14以上
* npm または yarn
* Firebase プロジェクト
* Render.com アカウント（または同等のNode.jsホスティングサービス）

### ローカル開発環境セットアップ
1. **リポジトリのクローン**:

```bash
git clone https://github.com/yourusername/textstation-pro.git
cd textstation-pro
```

2. **バックエンド環境構築**:

```bash
# バックエンドディレクトリへ移動
cd backend

# 依存関係のインストール
npm install

# 環境設定ファイルの作成
cp .env.example .env
# .envファイルを編集して必要情報を設定
```

3. **Firebase設定**:

```bash
# Firebase CLIのインストール
npm install -g firebase-tools

# Firebaseへのログイン
firebase login

# Firestoreの初期化
firebase init firestore

# セキュリティルールとインデックスのデプロイ
firebase deploy --only firestore:rules,firestore:indexes
```

4. **スプレッドシート設定**:
* 新規Google Spreadsheetを作成
* 「拡張機能」→「Apps Script」でスクリプトエディタを開く
* Code.gsとTriggers.gsのコードをコピー
* 以下の4つのシートを作成:
   * メイン: テキスト入力と結果表示用
   * 設定: API連携とユーザー設定用
   * スニペット: 定型文管理用
   * ログ: 操作履歴用
* APIキーとURLを設定シートに設定

5. **開発サーバー起動**:

```bash
# バックエンド開発サーバーの起動
npm run dev
```

## 技術的課題と解決アプローチ
### 1. GASの実行時間制限の克服
**課題**: GASには6分の実行時間制限がある
**解決策**:
* 処理の分割と非同期化
* 即時処理と詳細処理の分離
* 重い処理をNode.jsにオフロード

### 2. Firestore無料枠の最適化
**課題**: Firestoreの無料枠は読み書き回数に制限あり
**解決策**:
* ログデータは週次でバッチ集約
* 頻出データはキャッシュ活用
* インデックス最適化でクエリコスト削減

### 3. Render.com無料プランのスリープモード対策
**課題**: 無料プランではアイドル時にスリープする
**解決策**:
* 起動時のウォームアップ処理
* ステートレス設計によるコールドスタート高速化
* APIレスポンスのクライアント側キャッシュ

## 今後の開発計画
現在「概念実証」段階にあるため、以下の項目が優先課題です：

### 1. **統合テスト環境の構築**:
   * 実際のGAS-Node.js連携テスト
   * Firestoreとの接続安定性検証
   * エラーハンドリングの堅牢化

### 2. **APIセキュリティ強化**:
   * トークンベース認証の実装
   * OAuth連携の検討
   * APIレート制限の導入

### 3. **パフォーマンス最適化**:
   * 大量データ処理時の応答性向上
   * Firestore読み書き最適化
   * バックエンドキャッシュ戦略の実装

### 4. **機能拡張**:
   * 複数ユーザー対応と権限管理
   * AI文章推敲機能の統合検討
   * メディア別分析ルールの拡充

## 貢献とフィードバック
本プロジェクトは現在開発段階にあり、技術的なフィードバックを歓迎します。特に以下の領域での知見提供をお待ちしています：
* GAS-Node.js連携の効率化
* Firestoreのコスト最適化パターン
* テキスト分析アルゴリズムの精度向上
* PDF生成の高速化
